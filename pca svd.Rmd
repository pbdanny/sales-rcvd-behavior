---
title: "Dimansionality Reduction with PCA & SVD"
author: "Thanakrit Danny"
date: "1/12/2018"
output: html_document
---

```{r load_project, echo = FALSE, message = FALSE}

rm(list = ls()) # refresh workspace
library(ProjectTemplate); load.project() # load all cached file
# move agent_code to rownames
rownames(df) <- df$agent_code
df$agent_code <- NULL
```             

# PCA
## Main idea of PCA
If X is data matrix, there is way to transform X in to some matrix (or basis/ or axis) that could preserved its varience.

Then the some matrix = W "loading matrix"
And the transformed matrix of X on W call matrix T "score matrix"
T = XW
The methods to find W "loading matrix" could used Eigenvalue of covarience matrix

### Varience-Covarience matrix - step by step ; function *cov*
```{r var-covar matrix, echo = FALSE, message = FALSE}
# create devivation score matrix
# sample statistic use n - 1 in calculation 
n <- nrow(df)
sample_n <- n - 1

# square matrix of 1 with dimension = nrow of df
isqrt <- matrix(rep(1, n*n), ncol = n, nrow = n)
dev_score <- as.matrix(df - (isqrt %*% as.matrix(df/sample_n)))

# varience - covarience matrix
var_covar <- (t(dev_score) %*% dev_score) / sample_n

# or use the command cov(df) which yield almost identical result
var_covar <- cov(df)
```

The **R** command *cor* produce = var-covariance matrix of *normalized* data; with covarience of each pairs between [-1, 1] = *correlation*
```{r var-cov matrix and corr matrix, echo = TRUE, eval = FALSE}
# covariance matrix use the normalized data for dav_score calculation
dev_score_norm <- dev_score <- as.matrix(scale(df) - (isqrt %*% as.matrix(scale(df)/sample_n)))

# var-cov of normalized data
var_covar_norm <- (t(dev_score_norm) %*% dev_score_norm) / sample_n
print(var_covar_norm)

# same result as
cor(df)
```

### Analysis & visualization

Plot & analyzed with package *GGally* **super slow**
```{r visualize GGally, echo = TRUE, eval = FALSE}
# GGally 
GGally::ggpairs(df)
```

Use *correlation matrix* inplace of var-covar matrix.
Plot with package *corrplot*
```{r visualize corrplot, echo = FALSE, eval = TRUE}
# corrplot work with normalizized var-covar matrix
dev_score_norm <- dev_score <- as.matrix(scale(df) - (isqrt %*% as.matrix(scale(df)/sample_n)))
var_covar_norm <- (t(dev_score_norm) %*% dev_score_norm) / sample_n

# plot wth library corrplot
corrplot::corrplot(var_covar_norm)
```

### PCA with W "loading matrix" from Eigenvalue-Eigenvector of var-cov matrix

The property of W "loading matrix" is its column ordered by eigenvalue order, magnitude of data covarience. Or the by the principal value.

Then the dot product of data matrix X with truncated matrix of W with first column r 
Tr = XWr will have nxr column, Tr is the X represented in basis W
```{r loading from igen, echo = FALSE, eval = TRUE}
# remove na from matrix

var_covar <- var_covar[c(-15,-16), c(-15,-16)]
loading <- eigen(var_covar)
```

